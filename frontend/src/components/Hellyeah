import React, { useState, useRef, useMemo, useEffect } from 'react';
import { Search, Plus, Edit2, Trash2, Filter, X, Eye, Printer, Camera, Save, User, HeartPulse, MoreHorizontal, CreditCard, ChevronLeft, ChevronRight, MapPin, Upload, FileText, Phone, Download, AlertTriangle, CheckCircle } from 'lucide-react';
import { pwdAdminAPI } from '../../api';

// --- CONFIRMATION MODAL COMPONENT ---
const ConfirmationModal = ({ isOpen, title, message, type = 'info', onConfirm, onCancel, isLoading }) => {
  if (!isOpen) return null;

  const styles = {
    danger: {
      bg: 'bg-red-50', icon: <Trash2 size={32} className="text-red-600" />, btn: 'bg-red-600 hover:bg-red-700 text-white'
    },
    info: {
      bg: 'bg-blue-50', icon: <CheckCircle size={32} className="text-blue-600" />, btn: 'bg-blue-600 hover:bg-blue-700 text-white'
    },
    warning: {
      bg: 'bg-amber-50', icon: <AlertTriangle size={32} className="text-amber-600" />, btn: 'bg-amber-600 hover:bg-amber-700 text-white'
    }
  };

  const currentStyle = styles[type] || styles.info;

  return (
    <div className="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 transform scale-100 transition-all">
        <div className="flex flex-col items-center text-center space-y-4">
          <div className={`w-16 h-16 rounded-full flex items-center justify-center ${currentStyle.bg} mb-2`}>
            {currentStyle.icon}
          </div>
          <h3 className="text-xl font-black text-gray-800">{title}</h3>
          <p className="text-sm text-gray-500 font-medium leading-relaxed">
            {message}
          </p>
          <div className="flex gap-3 w-full pt-4">
            <button 
              onClick={onCancel}
              disabled={isLoading}
              className="flex-1 py-3 bg-gray-100 text-gray-600 font-bold rounded-xl hover:bg-gray-200 transition-colors text-sm"
            >
              Cancel
            </button>
            <button 
              onClick={onConfirm}
              disabled={isLoading}
              className={`flex-1 py-3 font-bold rounded-xl transition-all shadow-lg active:scale-95 text-sm flex items-center justify-center gap-2 ${currentStyle.btn} disabled:opacity-50`}
            >
              {isLoading ? 'Processing...' : 'Confirm'}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

// --- MAIN COMPONENT ---

const ManageView = () => {
  // Export CSV handler
  const handleExportCSV = () => {
    if (!localRecords || localRecords.length === 0) return;
    const replacer = (key, value) => value === null || value === undefined ? '' : value;
    const header = Object.keys(localRecords[0]);
    const csv = [
      header.join(','),
      ...localRecords.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(','))
    ].join('\r\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'pwd_users.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
  };

  const [localRecords, setLocalRecords] = useState([]); 
  const [searchQuery, setSearchQuery] = useState('');
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 8;
  
  const [showFormModal, setShowFormModal] = useState(false);
  const [showInfoModal, setShowInfoModal] = useState(false);
  const [showFilters, setShowFilters] = useState(false);
  
  const [editingRecord, setEditingRecord] = useState(null);
  const [selectedRecord, setSelectedRecord] = useState(null); 
  const [viewRecord, setViewRecord] = useState(null);
  const [openMenuRowId, setOpenMenuRowId] = useState(null);

  const [isCapturing, setIsCapturing] = useState(false);
  const [capturedPhoto, setCapturedPhoto] = useState(null);
  const [causeType, setCauseType] = useState('');
  const [causeSpecific, setCauseSpecific] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);

  // --- CONFIRMATION STATE ---
  const [confirmState, setConfirmState] = useState({
    isOpen: false,
    title: '',
    message: '',
    type: 'info',
    action: null
  });

  const [filterCriteria, setFilterCriteria] = useState({
    status: '',
    disabilityType: '',
    clusterGroupNo: ''
  });

  const videoRef = useRef(null);
  const canvasRef = useRef(null);
  const fileInputRef = useRef(null);

  const disabilityTypes = [
    { id: 1, name: "Visual Impairment" },
    { id: 2, name: "Hearing Impairment" },
    { id: 3, name: "Physical Disability" },
    { id: 4, name: "Intellectual Disability" },
    { id: 5, name: "Psychosocial Disability" },
    { id: 6, name: "Speech Disability" },
    { id: 7, name: "Multiple Disabilities" }
  ];

  // --- HELPER FUNCTIONS ---
  const getDisabilityName = (disabilityId) => {
    if (!disabilityId) return 'N/A';
    const idNum = parseInt(disabilityId);
    const disability = disabilityTypes.find(d => d.id === idNum);
    return disability ? disability.name : 'N/A';
  };

  const getDisabilityId = (disabilityName) => {
    const disability = disabilityTypes.find(d => d.name === disabilityName);
    return disability ? disability.id : null;
  };

  const getDisabilityValueForForm = (record) => {
    if (!record) return '';
    const val = record.disabilityType || record.disability_type; 
    if (!isNaN(val)) {
      const found = disabilityTypes.find(t => t.id === parseInt(val));
      return found ? found.name : '';
    }
    return val || '';
  };

  const formatDateForInput = (dateString) => {
    if (!dateString) return '';
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return ''; 
    return date.toISOString().split('T')[0];
  };

  const calculateAge = (birthdate) => {
    if (!birthdate) return '';
    const dob = new Date(birthdate);
    const diff_ms = Date.now() - dob.getTime();
    const age_dt = new Date(diff_ms);
    return Math.abs(age_dt.getUTCFullYear() - 1970);
  };

  useEffect(() => {
    const loadRecords = async () => {
      try {
        setIsLoading(true);
        const response = await pwdAdminAPI.getRegistrants();
        const records = Array.isArray(response) ? response : (response.data || response.registrants || []);
        if (Array.isArray(records) && records.length > 0) {
          setLocalRecords(records);
        }
      } catch (err) {
        console.error('Error loading records:', err);
        setError(err.message || 'Failed to load records');
      } finally {
        setIsLoading(false);
      }
    };
    loadRecords();
  }, []);

  const refreshRecords = async () => {
    try {
      const response = await pwdAdminAPI.getRegistrants();
      const records = Array.isArray(response) ? response : (response.data || response.registrants || []);
      if (Array.isArray(records) && records.length > 0) {
        setLocalRecords(records);
      }
    } catch (err) {
      console.error('Error refreshing records:', err);
    }
  };

  useEffect(() => {
    if (selectedRecord) {
      setCapturedPhoto(selectedRecord.photo || null);
    }
  }, [selectedRecord]);

  const filteredRows = useMemo(() => {
    return (localRecords || []).filter(row => {
      const firstName = row.firstName || row.firstname || '';
      const lastName = row.lastName || row.lastname || '';
      const name = `${firstName} ${lastName}`.toLowerCase();
      const id = (row.id || row.pwd_id || '').toString().toLowerCase();
      const search = searchQuery.toLowerCase();
      
      const matchesSearch = name.includes(search) || id.includes(search);
      const matchesStatus = filterCriteria.status ? row.registration_status === filterCriteria.status : true;
      const matchesType = filterCriteria.disabilityType ? getDisabilityName(row.disabilityType || row.disability_type) === filterCriteria.disabilityType : true;
      const matchesCluster = filterCriteria.clusterGroupNo ? (row.clusterGroupNo || row.cluster_group_no) == filterCriteria.clusterGroupNo : true;

      return matchesSearch && matchesStatus && matchesType && matchesCluster;
    });
  }, [localRecords, searchQuery, filterCriteria]);

  const totalPages = Math.ceil(filteredRows.length / itemsPerPage);
  const currentItems = filteredRows.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);

  const handleAddNew = () => {
    setEditingRecord(null);
    setCauseType('');
    setCauseSpecific('');
    setShowFormModal(true);
  };

  const handleOpenEdit = (record) => {
    setEditingRecord(record);
    const cause = record.disabilityCause || record.disability_cause;
    if (cause) {
      const parts = cause.split(' - ');
      if(parts.length > 1) {
          setCauseType(parts[0] || '');
          setCauseSpecific(parts[1] || '');
      } else {
          setCauseType(cause);
          setCauseSpecific('');
      }
    } else {
      setCauseType('');
      setCauseSpecific('');
    }
    setShowFormModal(true);
  };

  // --- DELETE LOGIC ---
  const triggerDelete = (record) => {
    setConfirmState({
      isOpen: true,
      title: 'Delete Record?',
      message: `Are you sure you want to permanently delete ${record.firstName || record.firstname} ${record.lastName || record.lastname}? This action cannot be undone.`,
      type: 'danger',
      action: () => executeDelete(record)
    });
  };

  const executeDelete = async (record) => {
    try {
      setIsLoading(true);
      const pwdId = record.pwd_id || record.id;
      await pwdAdminAPI.deleteRegistrant(pwdId);
      setLocalRecords(prev => prev.filter(r => (r.pwd_id || r.id) !== pwdId));
      setConfirmState({ ...confirmState, isOpen: false });
      // alert('Record deleted successfully!'); // Optional, modal closing implies success
    } catch (err) {
      console.error('Error deleting record:', err);
      alert('Error: ' + (err.message || 'Failed to delete record'));
    } finally {
      setIsLoading(false);
    }
  };

  // --- SAVE LOGIC ---
  const handleFormSubmit = (e) => {
    e.preventDefault();
    const formData = new FormData(e.currentTarget);
    const formValues = Object.fromEntries(formData.entries());
    
    // Open Confirmation Modal before saving
    setConfirmState({
      isOpen: true,
      title: editingRecord ? 'Update Record?' : 'Create New Record?',
      message: editingRecord 
        ? `You are about to update the profile for ${formValues.firstName} ${formValues.lastName}. Continue?`
        : `You are adding ${formValues.firstName} ${formValues.lastName} to the registry. Confirm?`,
      type: 'info',
      action: () => executeSave(formData) // Pass formData to execution
    });
  };

  const executeSave = async (formData) => {
    setIsLoading(true);
    setError(null);

    try {
      const adminId = localStorage.getItem('userId');
      const cType = String(causeType || '');
      const cSpecific = String(causeSpecific || '');
      const finalCause = cType && cSpecific ? `${cType} - ${cSpecific}` : (cType || cSpecific || '');

      const recordData = {
        userId: adminId || null,
        registryNumber: editingRecord?.id || null,
        firstName: String(formData.get('firstName') || '').toUpperCase(),
        lastName: String(formData.get('lastName') || '').toUpperCase(),
        middleName: String(formData.get('middleName') || '').toUpperCase(),
        suffix: String(formData.get('suffix') || '').toUpperCase(),
        gender: String(formData.get('sex') || 'Male'),
        dateOfBirth: String(formData.get('birthdate') || ''),
        civilStatus: 'Single',
        hoa: String(formData.get('hoa') || ''),
        address: String(formData.get('address') || '').toUpperCase(),
        barangay: String(formData.get('barangay') || 'Nangka'),
        contactNumber: String(formData.get('contactNo') || ''),
        emergencyContact: String(formData.get('guardian') || '').toUpperCase(),
        emergencyNumber: String(formData.get('guardianContact') || ''),
        disabilityType: getDisabilityId(String(formData.get('disabilityType') || '')),
        disabilityCause: finalCause,
        registrationStatus: String(formData.get('status') || 'Active'),
        clusterGroupNo: String(formData.get('clusterGroupNo') || '1'),
      };

      if (editingRecord) {
        const recordId = editingRecord.pwd_id || editingRecord.id;
        await pwdAdminAPI.updateRegistrant(recordId, recordData);
      } else {
        await pwdAdminAPI.createRegistrant(recordData);
      }
      
      await refreshRecords();
      setShowFormModal(false);
      setConfirmState({ ...confirmState, isOpen: false });
    } catch (err) {
      console.error('Error saving record:', err);
      setError(err.message || 'Failed to save record');
      alert('Error: ' + (err.message || 'Failed to save record'));
    } finally {
      setIsLoading(false);
    }
  };

  const startCamera = async () => {
    setIsCapturing(true);
    setCapturedPhoto(null);
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      if (videoRef.current) videoRef.current.srcObject = stream;
    } catch (err) {
      alert("Camera access denied.");
      setIsCapturing(false);
    }
  };

  const capturePhoto = () => {
    if (videoRef.current && canvasRef.current) {
      const context = canvasRef.current.getContext('2d');
      if (context) {
        canvasRef.current.width = videoRef.current.videoWidth;
        canvasRef.current.height = videoRef.current.videoHeight;
        context.drawImage(videoRef.current, 0, 0);
        setCapturedPhoto(canvasRef.current.toDataURL('image/png'));
        const stream = videoRef.current.srcObject;
        if (stream) stream.getTracks().forEach(track => track.stop());
        setIsCapturing(false);
      }
    }
  };

  const handleFileChange = (e) => {
    const file = e.target.files?.[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        setCapturedPhoto(reader.result);
        if (isCapturing) {
          const stream = videoRef.current?.srcObject;
          if (stream) stream.getTracks().forEach(track => track.stop());
          setIsCapturing(false);
        }
      };
      reader.readAsDataURL(file);
    }
  };

  const handleSaveAndExit = () => {
    if (selectedRecord) {
      const updatedRecord = { ...selectedRecord, photo: capturedPhoto || undefined };
      setLocalRecords(prev => prev.map(r => r.id === selectedRecord.id ? updatedRecord : r));
    }
    setSelectedRecord(null);
    setCapturedPhoto(null);
    setIsCapturing(false);
  };

  const handlePrint = () => window.print();
  const handleBrowsePhoto = () => fileInputRef.current?.click();

  return (
    <div className="p-4 md:p-8 max-w-7xl mx-auto space-y-6">
      <style>{`
        input, select, textarea { color: #000 !important; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; margin: 4px; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 20px; border: 2px solid transparent; background-clip: content-box; }
        ::-webkit-scrollbar-thumb:hover { background: #800000; border: 0; border-radius: 20px; }
        @media print {
          body * { visibility: hidden !important; }
          .no-print, .no-print-overlay { display: none !important; }
          .id-card-replica, .id-card-replica * { visibility: visible !important; display: flex !important; }
          .fixed.inset-0.z-\\[130\\] { visibility: visible !important; display: block !important; position: absolute !important; top: 0 !important; left: 0 !important; background: white !important; }
          .no-print-container { visibility: visible !important; display: block !important; background: white !important; box-shadow: none !important; border: none !important; position: absolute !important; top: 0 !important; left: 0 !important; width: 100% !important; }
          .id-card-replica { margin: 0 auto 40px auto !important; page-break-inside: avoid !important; -webkit-print-color-adjust: exact !important; border: 1px solid #ccc !important; }
        }
      `}</style>

      {/* CONFIRMATION MODAL */}
      <ConfirmationModal 
        isOpen={confirmState.isOpen}
        title={confirmState.title}
        message={confirmState.message}
        type={confirmState.type}
        onConfirm={confirmState.action}
        onCancel={() => setConfirmState(prev => ({ ...prev, isOpen: false }))}
        isLoading={isLoading}
      />

      {/* Header */}
      <div className="flex flex-col md:flex-row md:items-center justify-between gap-4 no-print border-t border-gray-200 pt-6">
        <div>
          <h2 className="text-2xl font-bold text-gray-800">Citizen Records</h2>
          <p className="text-sm text-gray-500">Manage, verify, and print official PWD identification cards.</p>
        </div>
        <div className="flex gap-2">
          <button onClick={handleExportCSV} className="flex items-center gap-2 px-5 py-3 bg-white text-gray-700 border border-gray-300 rounded-xl shadow-sm text-sm font-bold hover:bg-gray-50 hover:text-[#800000] transition-all active:scale-95">
            <Download size={18} /> Export CSV
          </button>
          <button onClick={handleAddNew} className="flex items-center gap-2 px-6 py-3 bg-[#800000] text-white text-sm font-bold rounded-xl hover:bg-[#600000] shadow-lg transition-all active:scale-95">
            <Plus size={18} /> New Record
          </button>
        </div>
      </div>

      {/* Search & Filter */}
      <div className="bg-white rounded-2xl border border-gray-200 shadow-sm p-4 flex flex-col md:flex-row gap-4 items-center no-print">
        <div className="relative flex-grow w-full md:max-w-md">
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" size={18} />
          <input 
            type="text" 
            placeholder="Search by name or PWD ID..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-12 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-[#800000]/10 focus:border-[#800000] transition-all text-black placeholder-gray-400"
          />
        </div>
        <div className="relative">
          <button 
            onClick={() => setShowFilters(!showFilters)}
            className={`flex items-center gap-2 px-4 py-3 rounded-xl border transition-all ${showFilters ? 'bg-gray-100 border-[#800000] text-[#800000]' : 'bg-gray-50 border-gray-200 text-gray-600'}`}
          >
            <Filter size={18} />
            <span className="text-sm font-bold">Filters</span>
          </button>
          {showFilters && (
            <div className="absolute right-0 top-full mt-2 w-72 bg-white rounded-2xl shadow-2xl border border-gray-100 z-50 p-5 space-y-4">
               <div className="space-y-1">
                  <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest">Disability Type</label>
                  <select className="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-xs font-bold text-black" value={filterCriteria.disabilityType} onChange={(e) => setFilterCriteria({...filterCriteria, disabilityType: e.target.value})}>
                    <option value="">All Types</option>
                    {disabilityTypes.map(t => <option key={t.id} value={t.name}>{t.name}</option>)}
                  </select>
               </div>
               <div className="space-y-1">
                  <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest">Status</label>
                  <select className="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-xs font-bold text-black" value={filterCriteria.status} onChange={(e) => setFilterCriteria({...filterCriteria, status: e.target.value})}>
                    <option value="">All Statuses</option>
                    <option value="Active">Active</option>
                    <option value="Pending">Pending</option>
                    <option value="Inactive">Inactive</option>
                  </select>
               </div>
               <div className="space-y-1">
                  <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest">Cluster Group</label>
                  <select className="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-xs font-bold text-black" value={filterCriteria.clusterGroupNo} onChange={(e) => setFilterCriteria({...filterCriteria, clusterGroupNo: e.target.value})}>
                    <option value="">All Clusters</option>
                    {[1,2,3,4,5,6].map(n => <option key={n} value={n}>Cluster {n}</option>)}
                  </select>
               </div>
               <button onClick={() => setFilterCriteria({ status:'', disabilityType:'', clusterGroupNo:'' })} className="w-full py-2 text-[10px] font-black uppercase text-red-700 hover:bg-red-50 rounded-lg transition-colors">Clear Filters</button>
            </div>
          )}
        </div>
      </div>

      {/* Main Table */}
      <div className="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden no-print">
        <div className="overflow-x-auto">
          <div className="overflow-x-auto rounded-2xl border border-gray-200 shadow-sm">
            <table className="w-full text-left text-sm">
              <thead>
                <tr className="bg-gradient-to-r from-[#800000]/10 to-red-50 border-b-2 border-[#800000]/20 sticky top-0 z-10">
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">PWD ID</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">First Name</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Middle Name</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Last Name</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Suffix</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Sex</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Birthdate</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Age</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Contact No</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Address</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">HOA</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Barangay</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Disability Type</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Disability Cause</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Status</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Guardian Name</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Guardian Contact</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Reg Date</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Cluster</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] whitespace-nowrap">Active</th>
                  <th className="px-5 py-4 font-bold text-[#800000] uppercase tracking-wide text-[10px] text-right whitespace-nowrap">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-100">
                {currentItems.length > 0 ? currentItems.map((row, idx) => {
                  const uniqueId = row.pwd_id || row.id;
                  
                  return (
                    <tr key={uniqueId} className={`transition-all duration-200 hover:bg-gradient-to-r hover:from-[#800000]/5 hover:to-red-50/50 group ${idx % 2 === 0 ? 'bg-white' : 'bg-gray-50/30'}`}>
                      <td className="px-5 py-4 text-gray-900 whitespace-nowrap font-medium text-xs">{row.formattedPwdId || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-900 whitespace-nowrap">{row.firstname || row.firstName || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap">{row.middlename || row.middleName || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-900 whitespace-nowrap">{row.lastname || row.lastName || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-900 whitespace-nowrap font-medium">{(row.suffix || row.Suffix) ? (row.suffix || row.Suffix) : <span className="text-gray-400">N/A</span>}</td>
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap">{row.sex || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap text-xs">{row.birthdate ? new Date(row.birthdate).toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' }) : <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-900 whitespace-nowrap text-sm">{row.age || calculateAge(row.birthdate) || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap text-xs">{row.contact_no || row.contactNo || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap max-w-xs truncate text-xs">{row.address || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap text-xs font-medium">{row.hoa || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap text-xs">{row.barangay || 'Nangka'}</td>
                      <td className="px-5 py-4 text-gray-900 whitespace-nowrap font-medium text-xs">{getDisabilityName(row.disability_type || row.disabilityType) || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap max-w-xs truncate text-xs">{row.disability_cause || row.disabilityCause || <span className="text-gray-400">â€”</span>}</td>
                      
                      <td className="px-5 py-4 whitespace-nowrap">
                        <span className={`w-24 inline-flex justify-center items-center py-1.5 rounded-full text-[10px] font-bold uppercase tracking-wider border ${
                          (row.registration_status || row.status) === 'Active' 
                            ? 'bg-emerald-100 text-emerald-800 border-emerald-300 shadow-sm' 
                            : 'bg-amber-100 text-amber-800 border-amber-300 shadow-sm'
                        }`}>
                          {row.registration_status || row.status || 'â€”'}
                        </span>
                      </td>
                      
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap text-xs">{row.guardian_name || row.guardianName || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap text-xs">{row.guardian_contact || row.guardianContact || <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-700 whitespace-nowrap text-xs">{row.registration_date ? new Date(row.registration_date).toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' }) : <span className="text-gray-400">â€”</span>}</td>
                      <td className="px-5 py-4 text-gray-900 whitespace-nowrap font-medium text-xs">Group {row.cluster_group_no || row.clusterGroupNo || 'N/A'}</td>
                      <td className="px-5 py-4 text-gray-800 whitespace-nowrap">
                        <span className={`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border ${row.is_active ? 'bg-blue-100 text-blue-800 border-blue-300 shadow-sm' : 'bg-gray-200 text-gray-700 border-gray-300 shadow-sm'}`}>
                          {row.is_active ? 'âœ“ Yes' : 'No'}
                        </span>
                      </td>
                      
                      <td className="px-5 py-4 text-right">
                        <div className="flex items-center justify-end gap-1.5">
                          <button onClick={() => handleOpenEdit(row)} className="p-2 text-gray-500 hover:text-[#800000] hover:bg-red-100 rounded-lg transition-all" title="Edit"><Edit2 size={16} /></button>
                          <button onClick={() => triggerDelete(row)} className="p-2 text-gray-500 hover:text-red-600 hover:bg-red-100 rounded-lg transition-all" title="Delete"><Trash2 size={16} /></button>
                          
                          <div className="relative inline-block text-left z-10">
                            <button 
                              onClick={() => setOpenMenuRowId(openMenuRowId === uniqueId ? null : uniqueId)} 
                              className={`p-2 rounded-lg transition-all ${openMenuRowId === uniqueId ? 'text-[#800000] bg-red-50' : 'text-gray-500 hover:text-[#800000] hover:bg-gray-100'}`}
                            >
                              <MoreHorizontal size={16} />
                            </button>
                            {openMenuRowId === uniqueId && (
                              <div className="absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-xl shadow-lg z-50 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200">
                                <button onClick={() => { setSelectedRecord(row); setOpenMenuRowId(null); }} className="w-full text-left px-4 py-3 text-sm font-semibold text-gray-700 hover:bg-red-50 hover:text-[#800000] flex items-center gap-3 border-b border-gray-100 transition-colors">
                                  <CreditCard size={16} /> ID Preview
                                </button>
                                <button onClick={() => { setViewRecord({
                                      ...row,
                                      firstName: row.firstName || row.firstname || '',
                                      middleName: row.middleName || row.middlename || '',
                                      lastName: row.lastName || row.lastname || '',
                                      disabilityType: row.disabilityType || row.disability_type || null,
                                      status: row.status || row.registration_status || null,
                                      guardian: row.guardian || row.guardian_name || null,
                                      guardianContact: row.guardianContact || row.guardian_contact || null,
                                      contactNo: row.contactNo || row.contact_no || 'N/A',
                                    }); setShowInfoModal(true); setOpenMenuRowId(null); }} className="w-full text-left px-4 py-3 text-sm font-semibold text-gray-700 hover:bg-red-50 hover:text-[#800000] flex items-center gap-3 transition-colors">
                                  <Eye size={16} /> View Details
                                </button>
                              </div>
                            )}
                          </div>
                        </div>
                      </td>
                    </tr>
                  );
                }) : (
                  <tr><td colSpan={21} className="px-5 py-20 text-center"><div className="flex flex-col items-center gap-2"><div className="text-gray-400 text-4xl mb-2">ðŸ“‹</div><p className="text-gray-500 font-semibold">No records found</p></div></td></tr>
                )}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {/* FORM MODAL */}
      {showFormModal && (
        <div className="fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/10 backdrop-blur-sm overflow-y-auto">
          <div className="bg-[#EBEBEB] rounded-3xl shadow-2xl w-full max-w-5xl overflow-hidden my-8 border border-gray-700">
            <div className="px-8 py-6 bg-[#800000] text-white flex items-center justify-between sticky top-0 z-10">
              <h3 className="text-xl font-black uppercase tracking-tight flex items-center gap-3">{editingRecord ? 'Update PWD Profile' : 'New PWD Member Registration'}</h3>
              <button onClick={() => setShowFormModal(false)} className="p-2 hover:bg-white/20 rounded-full transition-colors"><X size={24} /></button>
            </div>
            
            <form className="p-10 space-y-10 max-h-[75vh] overflow-y-auto" onSubmit={handleFormSubmit}>
              <div className="space-y-6">
                <div className="flex items-center gap-3 border-b-3 border-gray-500 pb-3">
                  <div className="w-8 h-8 bg-red-50 rounded-lg flex items-center justify-center text-[#800000]"><User size={18} /></div>
                  <h4 className="font-black text-gray-800 uppercase text-sm tracking-widest">Personal Identification</h4>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                  <div className="space-y-2">
                    <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">First Name *</label>
                    <input name="firstName" type="text" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.firstName || editingRecord?.firstname || ''} required />
                  </div>
                  <div className="space-y-2">
                    <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Middle Name</label>
                    <input name="middleName" type="text" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.middleName || editingRecord?.middlename || ''} />
                  </div>
                  <div className="space-y-2">
                    <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Last Name *</label>
                    <input name="lastName" type="text" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.lastName || editingRecord?.lastname || ''} required />
                  </div>
                  
                  {/* FIX: Suffix Input (Checking lowercase property from DB) */}
                  <div className="space-y-2">
                    <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Suffix</label>
                    <input name="suffix" type="text" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.suffix || ''} />
                  </div>

                  <div className="space-y-2">
                    <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Sex</label>
                    <select name="sex" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.sex || 'Male'}>
                      <option>Male</option>
                      <option>Female</option>
                    </select>
                  </div>

                  {/* FIX: Birthdate Input (Using format helper) */}
                  <div className="space-y-2">
                    <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Birthdate *</label>
                    <input name="birthdate" type="date" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={formatDateForInput(editingRecord?.birthdate)} required />
                  </div>

                  <div className="space-y-2">
                    <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Contact Number</label>
                    <input name="contactNo" type="tel" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.contactNo || editingRecord?.contact_no || ''} />
                  </div>
                  <div className="space-y-2">
                    <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Cluster Group</label>
                    <select name="clusterGroupNo" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.clusterGroupNo || editingRecord?.cluster_group_no || '1'}>
                      {[1,2,3,4,5,6].map(n => <option key={n} value={n}>Cluster {n}</option>)}
                    </select>
                  </div>
                </div>
              </div>

              {/* Disability Information */}
              <div className="space-y-6">
                <div className="flex items-center gap-3 border-b-3 border-gray-500 pb-3">
                  <div className="w-8 h-8 bg-purple-50 rounded-lg flex items-center justify-center text-purple-800"><HeartPulse size={18} /></div>
                  <h4 className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Disability Information</h4>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                  <div className="space-y-4">
                    
                    {/* FIX: Disability Type (Using helper to convert ID to Name) */}
                    <div className="space-y-2">
                      <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Disability Type *</label>
                      <select name="disabilityType" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={getDisabilityValueForForm(editingRecord)} required>
                        <option value="">Select Type</option>
                        {disabilityTypes.map(type => <option key={type.id} value={type.name}>{type.name}</option>)}
                      </select>
                    </div>

                    <div className="space-y-2">
                      <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Registration Status</label>
                      <select name="status" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.status || editingRecord?.registration_status || 'Active'}>
                        <option>Active</option>
                        <option>Pending</option>
                        <option>Inactive</option>
                      </select>
                    </div>
                  </div>
                  <div className="bg-gray-50/50 p-6 rounded-2xl border-2 border-gray-400 space-y-6">
                    <p className="text-[10px] font-black text-[#800000] uppercase tracking-widest border-b border-red-100 pb-2">Cause of Disability</p>
                    <div className="grid grid-cols-2 gap-8">
                      <div className="space-y-3">
                        <label className="flex items-center gap-3 cursor-pointer">
                          <input type="radio" name="cause_type" value="Congenital / Inborn" className="w-4 h-4 text-[#800000]" onChange={(e) => setCauseType(e.target.value)} checked={causeType === 'Congenital / Inborn'} />
                          <span className="font-bold text-xs uppercase text-black">Congenital</span>
                        </label>
                      </div>
                      <div className="space-y-3">
                        <label className="flex items-center gap-3 cursor-pointer">
                          <input type="radio" name="cause_type" value="Acquired" className="w-4 h-4 text-[#800000]" onChange={(e) => setCauseType(e.target.value)} checked={causeType === 'Acquired'} />
                          <span className="font-bold text-xs uppercase text-black">Acquired</span>
                        </label>
                      </div>
                    </div>
                    <div className="space-y-2">
                      <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Specific Cause Details</label>
                      <input name="cause_specific" type="text" className="w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" placeholder="e.g., Accident, Disease, Birth Defect" value={causeSpecific} onChange={(e) => setCauseSpecific(e.target.value)} />
                    </div>
                  </div>
                </div>
              </div>

              {/* Residential & Support */}
              <div className="space-y-6">
                <div className="flex items-center gap-3 border-b-3 border-gray-500 pb-3">
                  <div className="w-8 h-8 bg-green-50 rounded-lg flex items-center justify-center text-green-700"><MapPin size={18} /></div>
                  <h4 className="font-black text-[#1F2937] uppercase text-sm tracking-widest">Residential & Support</h4>
                </div>
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
                  <div className="space-y-6">
                    <div className="grid grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Homeowners Association</label>
                        <input name="hoa" type="text" className="w-full px-4 py-4 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.hoa || ''} />
                      </div>
                      <div className="space-y-2">
                        <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Barangay</label>
                        <input name="barangay" type="text" className="w-full px-4 py-4 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.barangay || 'Nangka'} />
                      </div>
                    </div>
                    <div className="space-y-2">
                      <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Full Address *</label>
                      <textarea name="address" rows={4} className="w-full px-4 py-4 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black resize-none" defaultValue={editingRecord?.address || ''} required></textarea>
                    </div>
                  </div>
                  <div className="bg-[#F9FAFB] p-8 rounded-[2rem] border-2 border-gray-400 flex flex-col gap-6 h-full">
                    <div className="space-y-2">
                      <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Guardian Name</label>
                      <input name="guardian" type="text" className="w-full px-4 py-4 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.guardian || editingRecord?.guardian_name || ''} />
                    </div>
                    <div className="space-y-2">
                      <label className="text-[10px] font-black text-gray-500 uppercase tracking-widest">Guardian Contact</label>
                      <input name="guardianContact" type="tel" className="w-full px-4 py-4 bg-gray-200 border border-gray-300 rounded-xl text-sm font-bold text-black" defaultValue={editingRecord?.guardianContact || editingRecord?.guardian_contact || ''} />
                    </div>
                  </div>
                </div>
              </div>

              <div className="flex items-center justify-end gap-12 pt-10 border-t-3 border-gray-500">
                <button type="button" onClick={() => setShowFormModal(false)} className="text-gray-400 font-black text-xs uppercase tracking-widest hover:text-red-600">Discard</button>
                <button type="submit" disabled={isLoading} className="px-8 py-4 bg-[#800000] text-white text-sm font-black rounded-2xl hover:bg-[#600000] flex items-center gap-3 shadow-lg active:scale-95 disabled:opacity-50"><FileText size={18} /> {isLoading ? 'Saving...' : (editingRecord ? 'Update Record' : 'Register Citizen')}</button>
              </div>
            </form>
          </div>
        </div>
      )}

      {/* ID PREVIEW MODAL (Same as previous, just kept clean for brevity) */}
      {selectedRecord && (
        <div className="fixed inset-0 z-[130] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md overflow-y-auto no-print-overlay">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-6xl my-auto flex flex-col no-print-shadow overflow-hidden no-print-container">
            <div className="px-8 py-6 bg-white border-b border-gray-100 flex items-center justify-between sticky top-0 z-10 no-print">
              <h3 className="text-xl font-black text-gray-800 uppercase tracking-tighter">Official PWD ID Preview</h3>
              <button onClick={() => {setSelectedRecord(null); setCapturedPhoto(null);}} className="p-2 hover:bg-gray-100 rounded-full text-gray-400"><X size={24} /></button>
            </div>
            <div className="p-10 grid grid-cols-1 xl:grid-cols-2 gap-12 items-start justify-items-center print:p-0 print:block">
              <div className="space-y-12 print:space-y-8 print:w-full print:flex print:flex-col print:items-center">
                {/* ID FRONT */}
                <div className="id-card-replica id-card-replica-front shadow-2xl border border-gray-400">
                  <div className="replica-header">
                    <img src="./src/assets/logo.png" className="replica-logo-seal" />
                    <div className="replica-header-text"><h1 className="main-title">REPUBLIC OF THE PHILIPPINES</h1><h2 className="city-title">CITY OF MARIKINA</h2><h3 className="brgy-title">BARANGAY NANGKA</h3></div>
                    <div className="replica-logo-right"><img src="./src/assets/bagongpinas.png" className="replica-logo-bagong" /></div>
                  </div>
                  <div className="replica-body">
                    <h2 className="replica-title">BARANGAY NANGKA PWD MEMBER</h2>
                    <div className="replica-top-fields"><p>CLUSTER: <span className="underline-field">{selectedRecord.clusterGroupNo || selectedRecord.cluster_group_no || '______'}</span></p><p>TAG NO: <span className="underline-field">{(selectedRecord.id || selectedRecord.pwd_id || '').toString().split('-').pop() || '______'}</span></p></div>
                    <div className="replica-main-content">
                       <div className="replica-left-col"><div className="replica-photo-box">{capturedPhoto ? <img src={capturedPhoto} /> : <div className="replica-photo-placeholder"><User size={48} className="opacity-10" /></div>}</div><div className="replica-signature-block"><div className="replica-sig-line"></div><p>Signature Over Printed Name</p></div></div>
                       <div className="replica-right-col">
                          <DataRow label="FULL NAME:" value={`${selectedRecord.firstname || selectedRecord.firstName || ''} ${selectedRecord.middlename || selectedRecord.middleName || ''} ${selectedRecord.lastname || selectedRecord.lastName || ''}`} />
                          <DataRow label="ADDRESS:" value={selectedRecord.address || ''} />
                          <DataRow label="P.W.D ID NUMBER:" value={selectedRecord.formattedPwdId || selectedRecord.id || selectedRecord.pwd_id || ''} />
                          <DataRow label="TYPE OF DISABILITY:" value={getDisabilityName(selectedRecord.disability_type || selectedRecord.disabilityType) || 'N/A'} />
                       </div>
                    </div>
                  </div>
                  <div className="replica-footer"><p>"Ang ID na ito ay para lamang sa mga benepisyo sa Barangay Nangka"</p></div>
                </div>
                {/* ID BACK */}
                <div className="id-card-replica id-card-replica-back shadow-2xl border border-gray-400">
                   <div className="replica-header"><img src="./src/assets/logo.png" className="replica-logo-seal" /><div className="replica-header-text"><h1 className="main-title">REPUBLIC OF THE PHILIPPINES</h1></div><div className="replica-logo-right"><img src="./src/assets/bagongpinas.png" className="replica-logo-bagong" /></div></div>
                   <div className="replica-body-back"><div className="back-content-z"><h4 className="emergency-notify-label">IN CASE OF EMERGENCY, PLS, NOTIFY:</h4><div className="emergency-fields-group"><FieldRow label="NAME:" value={selectedRecord.guardian} /><FieldRow label="CONTACT NO.:" value={selectedRecord.guardianContact} /><FieldRow label="ADDRESS:" value={selectedRecord.guardianAddress} /></div></div></div>
                   <div className="replica-footer-back"><p>Valid only within Barangay Nangka.</p></div>
                </div>
              </div>
              {/* Camera Controls */}
              <div className="w-full max-w-sm space-y-6 no-print">
                 <div className="bg-slate-50 p-6 rounded-3xl border border-slate-200">
                    <h4 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6">Live Photo Studio</h4>
                    <div className="aspect-square bg-black rounded-2xl overflow-hidden relative shadow-inner mb-6">{isCapturing ? <video ref={videoRef} autoPlay playsInline className="w-full h-full object-cover scale-x-[-1]" /> : capturedPhoto ? <img src={capturedPhoto} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-slate-500"><Camera size={48} className="opacity-20" /></div>}</div>
                    <div className="grid grid-cols-2 gap-3"><button onClick={isCapturing ? capturePhoto : startCamera} className="w-full py-4 bg-[#1E293B] text-white rounded-xl font-bold uppercase text-xs flex items-center justify-center gap-2">{isCapturing ? "Capture" : "Camera"}</button><button onClick={handleBrowsePhoto} className="w-full py-4 bg-gray-200 text-gray-700 rounded-xl font-bold uppercase text-xs flex items-center justify-center gap-2">Browse</button></div>
                    <button onClick={handlePrint} className="w-full px-4 py-4 bg-[#800000] text-white rounded-xl font-bold uppercase flex items-center justify-center gap-2 mt-4">Print ID</button>
                    <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleFileChange} />
                 </div>
              </div>
            </div>
          </div>
          <canvas ref={canvasRef} className="hidden" />
        </div>
      )}

      {/* FULL INFO MODAL */}
      {showInfoModal && viewRecord && (
        <div className="fixed inset-0 z-[140] flex items-center justify-center p-4 bg-black/70 backdrop-blur-md overflow-y-auto">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl flex flex-col overflow-hidden">
            <div className="px-8 py-6 bg-[#800000] text-white flex items-center justify-between"><h3 className="text-xl font-black uppercase tracking-tight">Citizen Full Profile</h3><button onClick={() => setShowInfoModal(false)} className="p-2 hover:bg-white/20 rounded-full"><X size={24} /></button></div>
            <div className="p-10 space-y-8 max-h-[75vh] overflow-y-auto">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                <InfoItem label="Full Name" value={`${viewRecord.firstName} ${viewRecord.middleName} ${viewRecord.lastName}`} />
                <InfoItem label="Disability" value={getDisabilityName(viewRecord.disabilityType)} />
                <InfoItem label="Status" value={viewRecord.status} />
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// Helper Components
const DataRow = ({ label, value }) => (<div className="replica-data-row"><label>{label}</label><span className="replica-value">{value}</span></div>);
const FieldRow = ({ label, value }) => (<div className="field-row"><label>{label}</label><span>{value || ''}</span></div>);
const InfoItem = ({ label, value, mono }) => (<div><p className="text-[10px] font-black text-gray-400 uppercase tracking-widest">{label}</p><p className={`mt-1 text-sm font-bold ${mono ? 'font-mono text-[#800000]' : 'text-gray-800'}`}>{value}</p></div>);

export default ManageView;